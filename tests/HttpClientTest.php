<?php

require_once 'vendor/autoload.php';
use by\component\api5client\loginSession\LoginSessionApi;

date_default_timezone_set("PRC");

$devUri = 'http://127.0.0.1:8011/base';
$clientId = 'by04esfH0glASt';
$clientSecret = 'ee7c5016ee68051d9d3d9448ff3c89e7';
//
$systemPublicKey = "MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAu4ZtNXrVVtplpWbziT+7l3uS1rlZ6CcvaSpCKelHOk5olrRiePaRRviC4D2Sh4smbXQmyZvDuLp0oZg6OvSjTIrYKKViE0Kx49lkIz2jlgsypGJjACNtiVWKjbPo0aOqYB0Mve1IEHXOovOFMqfRYVREf0otK2Rbtsh2VNdIW2zUwYti6DIv0wknTZvIXEFpWWzM8+1vutVSwxE0GoBN9npKrdUJUBLWDWeVYexqgn81DG0BJV7Ke+ahxHWWq5czHdorJhIwYrHLCdrDRkY3+nXiPwoAvSQpqA0BwkfaRrBJdRhjeA4+6cpm0kLcQiBkN0Y6vcjhY9aSlH4HBOBzBwIDAQAB";
// 用户私钥
$userPrivateKey = "MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQCyttve5Hlhv3ADv1OEkxZaGpHm8vMbKtF8Y+kP8yxpSHeOJ3F+RhVjDppsLVYqpku6XAVkal/1l1gJsMpLGrrY6p61ZdXfiyS/kxaowA304UcBnQeRGB7FtAaJXnCxOtZo1MMsSjcAZf6uLy+uSEkUqCAKsrGW/VmipXjo0n6tFdwYi3zGiTXkxPxEQzUuoiGvsqxcT4/ZqJsA/JN4+r4K/DjYlOhFp4pvKObLx+U5AFb4b63z/2ZImPmMdzdQWuBA9uq/Xpro+GYcHuoMzvkxRWpnIzrLopM7s1Le6zJTlqvduKMzSeY4D1yQ9jfU2Bf5WuiB/OxpubbYVUJJ6sYvAgMBAAECggEAKV9z31H9V8e94uA0MYjrr8he5pxv82YiQS3QEsU1Dtqb8ujmuVj4Mop67XhBbnY5KdeL2AdYV77FvtiSvHhfsT//pfcBYFMSGteuczqjAIH2skTsL4bp+NMIgFzAsgbxBCvdUy+LNChooWKDI1HQuVuCr3dW7aGRUroEF8JDWUZHKkYqVbWqp8/H0uscKF/Sh6XQItvhJKbxuuRb5xySrsueP8gSuJ47T7aQRc9L3oQ1Fm8iyU6iFYE98o1ph1eioiVcO0xd2Ma/ddtW3Bqcwx8SF8fdEFGJHhmE5d9bX6TwnzkfzC4l8L4ENjKf/V6gIh+bHgeO6RK1Hm+mqn5uwQKBgQDdON7wG91dGoG71IzZzzeg1FNbLaOWuBelpZeTLHz9vZPZG9qCI05Z0Ftlj/blSqEvFi9OliE3dE6z6hKRhJtB+PL68Lmxuq4LSrQQxmZmCaOfWoD2j9a4JOIONn8iSCgF8KMHrlM4q0XS+9Cf2uPQhEtiq1Fqamdg9nrrniRTiQKBgQDOz0A2nZPheMICXXCVwzz219tfWC3209AosCFThrq7/lW6dSWJBCm+Y8hO4LVd6v7q9fSgBGqCuG1PW1WHJDY8uWc+9w/vXvFT7G9KiYn4GD8ZKGhpN27TmoTQ2cFI9TjI0S4w/mruobXyzNkWY/DyVhX7LkxCedx0xk2Hs7iF9wKBgAYP/OwPl21pwIxpMsL1Tsz1hKNHCOikeuFrPFAoM/SwMVEN1lsipI8JirepzlZSSUCFFx7MNnTSlyWPEJs0SxzvuZju5+fa+dINZgnfpga91OIVFNus7XF2cUt6atmBqLcg9RbMzDMNXoh9piX7VartNTOrBjwoVlTt7EhwuQYhAoGAEtujJ1fHHFA+oKiUk5NyA7A7OL55soAuAwfMgilO7cWLW61C9vOCOvIuWcLzxtSe2h4DaHP+olze2tWhPul2aKMfXwZ4VYN6zgRJQaq5Af50An9ExhNf77uvULwKe/SgcO9iHuWUKp5kUPeM9BW46uAesQDPw2AJUjyi5TTmJpECgYEApkR5l01Wo9i6yKkwqDO8g2wsXK84ASC5vFJUXpiukmBQ0aZAHZUlI7ZvxKh4FgXTFR/dg0E8gIURCaoo5kgPpxJ9U0tfdhhzu2TTOFkEsfXXQpk7w8036aXlEWyqSAVDDhAD3YHMwlU5yrDmENQSIGQcHFXPB1ICkA6WSI2LGBM=";
$systemPublicKey = \by\component\api5client\infra\RsaUtil::formatPublicText($systemPublicKey);
$userPrivateKey = \by\component\api5client\infra\RsaUtil::formatPrivateText($userPrivateKey);

$loginSessionApi = new LoginSessionApi();
$loginSessionApi->setApiUri($devUri);
$loginSessionApi->setClientId($clientId);
$loginSessionApi->setClientSecret($clientSecret);
$loginSessionApi->setSystemPublicKey($systemPublicKey);
$loginSessionApi->setUserPrivateKey($userPrivateKey);

//$ret = $loginSessionApi->login();
$ret = \by\infrastructure\helper\CallResultHelper::fail();
$token = 'eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJpc3MiOiJieV9hcGkiLCJhdWQiOiJkdGVzdGFkbWluIiwiaWF0IjoxNjI0MjU0NzQyLjIxMDQ3NiwibmJmIjoxNjI0MjU0NzQyLjIxMDQ3NiwiZXhwIjoxNjI0MjU1NjQyLjIxMDQ3NiwidWlkIjoyLCJuYW1lIjoiZHRlc3RhZG1pbiIsImhlYWQiOiJodHRwOi8vaW1nMS5oZWJpZHUuY24vdXBsb2Fkcy9hdmF0YXIvMi9hdmF0YXIucG5nIiwic2lkIjoiMSM2NjNlMmVjMjcxMWZiMjcwNGE0NGUwYTViNTFkNWNiYSJ9.i3-KIZ_s7-zao74GFFYKvOo89tHjMLh2kcSjMK_OvpvElkJDjpaaGkDzMmCpzISHD5x5v-iX3yzaGva6xc93B6hSvMSDvE-2goM7scf9_u7tb1yDTlI_Ct7ezp-ZkFl0TrDXL4bCbgwCLF8UlZdw2ezU3Ri1oaoYdR-inYG6n2HmT9b3NE08v73KF8iU6gLnmIjrdGvnCIjl3KrssPsKM6-7-ZzutlSU3GXCSeGJ8a4iNLun9CHhoPS4jA8Q-SVwFdPvrbEwbN_6q5Ij6SVJn0KQvOcGKdz22dN5JW6Wik2MtKCb1BfYFTB2gnNkRQb5hMj9vBtocw1zxr5xPR9WlQ';
var_dump($ret);

if ($ret->isSuccess()) {
    $data = $ret->getData();
    $token = $data['jwt'];
}
$ret = $loginSessionApi->setAuthorization($token)->check();
var_dump($ret);
